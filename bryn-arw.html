<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>STUMP UP for TREES - Bryn Arw</title>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

    <link
        rel="stylesheet"
        href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
        integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
        crossorigin=""
    />
    <script
        src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
        integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
        crossorigin=""
    ></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>

    <!-- https://github.com/torfsen/leaflet.zoomhome -->
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" href="leaflet.zoomhome.css"/>
    <script src="leaflet.zoomhome.min.js"></script>

    <!-- Tree Scale -->
    <link rel="stylesheet" href="leaflet.treescale.css"/>
    <script src="leaflet.treescale.js"></script>

    <link rel="stylesheet" href="suft.css"/>
    <style>
        #mapid {
            height: 450px;
        }
    </style>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <a class="navbar-brand" href="/">
            <img src="suft-logo.png" width="32" height="32" class="d-inline-block align-top" alt="">
            STUMP UP for TREES
        </a>
        <div class="collapse navbar-collapse justify-content-end" id="navbarNavAltMarkup">
            <div class="navbar-nav">
              <a class="nav-item nav-link" href="/">About</a>
              <a class="nav-item nav-link active" href="bryn-arw.html">Bryn Arw</a>
              <a class="nav-item nav-link" href="https://www.facebook.com/STUMP-UP-for-TREES-To-plant-a-million-trees-in-the-Brecon-Beacons-101784761316376/">News (Facebook)</a>
              <form class="form-inline">
                <button class="btn btn-outline-success" type="button">Donate</button>
              </form>
            </div>
          </div>
    </nav>

    <div class="px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center suft-header">
        <h1 class="display-4">Bryn Arw</h1>
        <p class="lead">We will plant 150-170k trees on Bryn Arw common in March 2021. It is the pilot for our million trees plant in March 2022.</p>
    </div>

    <div class="container text-center">
        <div id="mapid"></div>
    </div>

    <div class="container text-center py-3">
      &copy; 2020 STUMP UP for TREES
    </div>

    <script>
      // Area functions
      const TREES_PER_HECTARE = 170000 / 75; // based on planting 170000 trees on 75 ha of Bryn Awr
      const AREA_FOR_1M_TREES_IN_HA = 1000000 / TREES_PER_HECTARE;

      function acresToSqKm(acres) {
        return acres / 247;
      }

      function hectaresToSqKm(ha) {
        return ha / 100;
      }

      function hectaresToSqM(ha) {
        return 1000 * 1000 * ha / 100;
      }

      function hectaresToAcres(ha) {
        return ha * 2.471;
      }

      // These bounds were found by inspecting bbnpLayer.getBounds() from below, or by choosing one by eye
      const bounds = [[51.845853287945864, -3.1106758117675786], [51.89354997354335, -2.92013168334961]];

      // Create a map
      const map = L.map("mapid", {zoomControl: false}).fitBounds(bounds);

      // Add a home button to reset map
      var zoomHome = L.Control.zoomHome();
      zoomHome.addTo(map);

      // Use Open Street Map tiles
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      // Show planting areas

      const plantingAreaStyle = {
            color: 'green',
            opacity: 0.9,
            fillOpacity: 0.4
      };

      const plantingLayer = new L.GeoJSON.AJAX("data/planting_areas.geojson", {style: plantingAreaStyle})
        .on("data:loaded", function(data) {
          let totalHa = 0;
          for (let key in plantingLayer._layers){
            totalHa += plantingLayer._layers[key].feature.properties.area_ha;
          }
          const pct = 100 * totalHa / AREA_FOR_1M_TREES_IN_HA;
          new TreeScale({
            position: 'bottomleft',
            treesPerHectare: TREES_PER_HECTARE,
            progress: 0
          }).addTo(map);
        })
        .bindPopup(layer => {
          const props = layer.feature.properties;
          const area_ac = hectaresToAcres(props.area_ha);
          const num_trees = Math.round(TREES_PER_HECTARE * props.area_ha / 1000) * 1000; // round to nearest 1000
          const pct = 100 * props.area_ha / AREA_FOR_1M_TREES_IN_HA;
          const notes = props.notes == null ? '' : props.notes;
          return `<b>${props.name}</b>: ${props.area_ha.toFixed(0)} ha, ${area_ac.toFixed(0)} ac, ${num_trees} trees<br/>${notes}`;
        })
        .addTo(map);
    </script>
    
  </body>
</html>
